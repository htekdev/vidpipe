<!DOCTYPE html>
<html lang="en" class="h-full">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <title>vidpipe ‚Äî Review Queue (Grouped)</title>
  <script src="https://cdn.tailwindcss.com"></script>
  <script>
    tailwind.config = {
      darkMode: 'class',
      theme: {
        extend: {
          colors: {
            surface: '#1a1a2e',
            card: '#16213e',
            cardHover: '#1a2744',
            accent: '#0f3460',
          }
        }
      }
    }
  </script>
  <style>
    @keyframes fadeIn { from { opacity: 0; transform: translateY(12px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes fadeOut { from { opacity: 1; transform: translateY(0); } to { opacity: 0; transform: translateY(-12px); } }
    @keyframes slideInRight { from { opacity: 0; transform: translateX(40px); } to { opacity: 1; transform: translateX(0); } }
    @keyframes toastIn { from { opacity: 0; transform: translateY(-20px); } to { opacity: 1; transform: translateY(0); } }
    @keyframes toastOut { from { opacity: 1; } to { opacity: 0; transform: translateY(-20px); } }
    @keyframes spin { to { transform: rotate(360deg); } }
    @keyframes pulse { 0%, 100% { opacity: 1; } 50% { opacity: .5; } }

    .card-enter { animation: fadeIn 0.3s ease-out forwards; }
    .card-exit { animation: fadeOut 0.25s ease-in forwards; }
    .slide-in { animation: slideInRight 0.3s ease-out forwards; }
    .toast-enter { animation: toastIn 0.3s ease-out forwards; }
    .toast-exit { animation: toastOut 0.3s ease-in forwards; }
    .spinner { animation: spin 0.7s linear infinite; }
    .skeleton { animation: pulse 1.5s ease-in-out infinite; }

    /* Custom scrollbar */
    ::-webkit-scrollbar { width: 6px; }
    ::-webkit-scrollbar-track { background: #1a1a2e; }
    ::-webkit-scrollbar-thumb { background: #0f3460; border-radius: 3px; }

    /* Checkbox styling */
    .platform-checkbox {
      appearance: none;
      width: 20px;
      height: 20px;
      border: 2px solid rgba(255, 255, 255, 0.2);
      border-radius: 4px;
      cursor: pointer;
      position: relative;
      transition: all 0.2s ease;
    }
    .platform-checkbox:checked {
      background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
      border-color: #667eea;
    }
    .platform-checkbox:checked::after {
      content: '‚úì';
      position: absolute;
      top: 50%;
      left: 50%;
      transform: translate(-50%, -50%);
      color: white;
      font-size: 14px;
      font-weight: bold;
    }
    .platform-checkbox:hover {
      border-color: rgba(255, 255, 255, 0.4);
    }

    /* Action button hover effects */
    .action-btn { transition: all 0.15s ease; }
    .action-btn:hover { transform: translateY(-2px); }
    .action-btn:active { transform: translateY(0); }
    .action-btn:focus-visible { outline: 2px solid #60a5fa; outline-offset: 2px; }

    /* Platform filter tab */
    .platform-tab { transition: all 0.2s ease; }
    .platform-tab.active { border-bottom: 2px solid currentColor; }

    body { background: #0f0f23; }
  </style>
</head>
<body class="h-full text-gray-100 overflow-hidden">
  <div id="app" role="main" aria-label="Social media post review application"></div>

  <script type="module">
    import { h, render } from 'https://esm.sh/preact@10'
    import { useState, useEffect, useCallback, useRef } from 'https://esm.sh/preact@10/hooks'
    import htm from 'https://esm.sh/htm@3'
    const html = htm.bind(h)

    // ‚îÄ‚îÄ Platform config ‚îÄ‚îÄ
    const PLATFORMS = {
      tiktok:    { icon: 'üéµ', color: '#00f2ea', name: 'TikTok' },
      youtube:   { icon: '‚ñ∂Ô∏è',  color: '#ff0000', name: 'YouTube' },
      instagram: { icon: 'üì∏', color: '#e1306c', name: 'Instagram' },
      linkedin:  { icon: 'üíº', color: '#0077b5', name: 'LinkedIn' },
      twitter:   { icon: 'üê¶', color: '#1da1f2', name: 'X/Twitter' },
    }

    // ‚îÄ‚îÄ Helpers ‚îÄ‚îÄ
    function normalizePlatform(raw) {
      if (!raw) return 'unknown'
      const lower = raw.toLowerCase()
      if (lower.includes('tiktok') || lower === 'tik-tok') return 'tiktok'
      if (lower.includes('youtube') || lower === 'yt') return 'youtube'
      if (lower.includes('instagram') || lower === 'ig') return 'instagram'
      if (lower.includes('linkedin')) return 'linkedin'
      if (lower.includes('twitter') || lower === 'x') return 'twitter'
      return lower
    }

    function truncate(str, max) {
      if (!str) return ''
      return str.length > max ? str.slice(0, max) + '‚Ä¶' : str
    }

    function formatDate(iso) {
      try {
        const d = new Date(iso)
        return d.toLocaleDateString(undefined, { weekday: 'short', month: 'short', day: 'numeric' }) +
          ' ' + d.toLocaleTimeString(undefined, { hour: '2-digit', minute: '2-digit' })
      } catch { return iso }
    }

    // ‚îÄ‚îÄ Toast Container (imperative, lives outside Preact tree) ‚îÄ‚îÄ
    const toastContainer = document.createElement('div')
    toastContainer.className = 'fixed top-4 right-4 z-50 flex flex-col gap-2'
    document.body.appendChild(toastContainer)

    function showToast(message, type = 'info') {
      const colors = {
        success: 'bg-green-500/20 border-green-500/30 text-green-300',
        error:   'bg-red-500/20 border-red-500/30 text-red-300',
        info:    'bg-blue-500/20 border-blue-500/30 text-blue-300',
      }
      const icons = { success: '‚úÖ', error: '‚ö†Ô∏è', info: '‚ÑπÔ∏è' }
      const toast = document.createElement('div')
      toast.className = `toast-enter flex items-center gap-2 px-4 py-2.5 rounded-xl border backdrop-blur-sm text-sm shadow-lg ${colors[type] || colors.info}`
      const iconSpan = document.createElement('span')
      iconSpan.textContent = icons[type] || ''
      const msgSpan = document.createElement('span')
      msgSpan.textContent = message
      toast.appendChild(iconSpan)
      toast.appendChild(msgSpan)
      toastContainer.appendChild(toast)
      setTimeout(() => {
        toast.classList.remove('toast-enter')
        toast.classList.add('toast-exit')
        setTimeout(() => toast.remove(), 300)
      }, 4000)
    }

    // ‚îÄ‚îÄ Components ‚îÄ‚îÄ

    function LoadingOverlay({ busy, text }) {
      if (!busy) return null
      return html`
        <div class="fixed inset-0 z-40 bg-black/50 flex items-center justify-center">
          <div class="bg-card rounded-2xl p-8 flex flex-col items-center gap-3 shadow-2xl">
            <div class="w-8 h-8 border-3 border-blue-400 border-t-transparent rounded-full spinner" style="border-width:3px"></div>
            <span class="text-sm text-gray-400">${text}</span>
          </div>
        </div>`
    }

    function Header({ profileName }) {
      const subtitle = profileName ? `Review Queue ‚Äî ${profileName}` : 'Review Queue'
      return html`
        <header class="flex-shrink-0 border-b border-white/10 bg-surface/80 backdrop-blur-sm">
          <div class="max-w-4xl mx-auto px-4 py-3 flex items-center justify-between">
            <div class="flex items-center gap-3">
              <span class="text-xl font-bold bg-gradient-to-r from-blue-400 to-purple-400 bg-clip-text text-transparent">vidpipe</span>
              <span class="text-gray-500 text-sm">${subtitle}</span>
            </div>
            <div class="flex items-center gap-2 text-xs text-gray-500" aria-label="Keyboard shortcuts">
              <kbd class="px-1.5 py-0.5 bg-white/5 rounded border border-white/10">‚Üê</kbd> Reject
              <kbd class="px-1.5 py-0.5 bg-white/5 rounded border border-white/10">‚Üí</kbd> Approve
              <kbd class="px-1.5 py-0.5 bg-white/5 rounded border border-white/10">Space</kbd> Skip
            </div>
          </div>
        </header>`
    }

    function SkeletonCard() {
      return html`
        <div class="w-full max-w-2xl">
          <div class="bg-card rounded-2xl shadow-2xl border border-white/5 overflow-hidden">
            <div class="flex items-center justify-between px-5 pt-4 pb-2">
              <div class="flex items-center gap-2">
                <div class="w-6 h-6 bg-white/10 rounded skeleton"></div>
                <div class="w-20 h-4 bg-white/10 rounded skeleton"></div>
              </div>
              <div class="w-16 h-5 bg-white/10 rounded-full skeleton"></div>
            </div>
            <div class="px-5 pb-3">
              <div class="rounded-xl bg-white/5 aspect-video skeleton"></div>
            </div>
            <div class="px-5 pb-3 space-y-2">
              <div class="h-3 bg-white/10 rounded w-full skeleton"></div>
              <div class="h-3 bg-white/10 rounded w-5/6 skeleton"></div>
            </div>
          </div>
        </div>`
    }

    function EmptyState() {
      return html`
        <div class="flex flex-col items-center justify-center gap-4 text-center mt-20">
          <div class="text-6xl">üé¨</div>
          <h2 class="text-xl font-semibold text-gray-300">No posts pending review</h2>
          <p class="text-gray-500">Run your pipeline first!</p>
        </div>`
    }

    function SummaryState({ stats }) {
      return html`
        <div class="flex flex-col items-center justify-center gap-6 text-center mt-20">
          <div class="text-6xl">üéâ</div>
          <h2 class="text-2xl font-bold text-gray-200">All caught up!</h2>
          <div class="flex gap-6 text-sm">
            ${stats.approved > 0 && html`
              <div class="flex flex-col items-center px-4 py-2 bg-green-500/10 rounded-xl border border-green-500/20">
                <span class="text-2xl font-bold text-green-400">${stats.approved}</span>
                <span class="text-green-400/70">approved</span>
              </div>`}
            ${stats.rejected > 0 && html`
              <div class="flex flex-col items-center px-4 py-2 bg-red-500/10 rounded-xl border border-red-500/20">
                <span class="text-2xl font-bold text-red-400">${stats.rejected}</span>
                <span class="text-red-400/70">rejected</span>
              </div>`}
            ${stats.skipped > 0 && html`
              <div class="flex flex-col items-center px-4 py-2 bg-white/5 rounded-xl border border-white/10">
                <span class="text-2xl font-bold text-gray-400">${stats.skipped}</span>
                <span class="text-gray-500">skipped</span>
              </div>`}
          </div>
          <button onClick=${() => location.reload()} class="mt-4 px-6 py-2 bg-blue-600 hover:bg-blue-500 rounded-lg transition-colors text-sm font-medium">
            Refresh Queue
          </button>
        </div>`
    }

    function ClipTypeBadge({ clipType }) {
      const labels = { 'video': 'üìπ Full Video', 'short': '‚ö° Short', 'medium-clip': 'üé¨ Medium Clip' }
      return html`<span class="text-xs px-2 py-0.5 rounded-full bg-white/10 text-gray-400">${labels[clipType] || clipType}</span>`
    }

    function VideoPlayer({ group }) {
      const videoRef = useRef(null)
      const prevKeyRef = useRef(null)
      
      const firstItem = group.items[0]
      const hasMedia = group.hasMedia

      useEffect(() => {
        if (hasMedia && videoRef.current && prevKeyRef.current !== group.groupKey) {
          videoRef.current.load()
          prevKeyRef.current = group.groupKey
        }
      }, [group.groupKey, hasMedia])

      if (!hasMedia) {
        return html`
          <div class="px-5 pb-3">
            <div class="rounded-xl overflow-hidden bg-black/40 aspect-video relative">
              <div class="absolute inset-0 flex items-center justify-center bg-gradient-to-br from-purple-500/10 to-blue-500/10">
                <div class="text-center">
                  <div class="inline-flex items-center gap-2 px-4 py-2 rounded-full bg-white/10 border border-white/10 mb-2">
                    <span class="text-lg">üìù</span>
                    <span class="text-sm font-semibold text-gray-300">Text Only</span>
                  </div>
                  <div class="text-xs text-gray-500">No media attachment needed</div>
                </div>
              </div>
            </div>
          </div>`
      }

      const mediaUrl = `/media/queue/${encodeURIComponent(firstItem.id)}/media.mp4`
      return html`
        <div class="px-5 pb-3">
          <div class="rounded-xl overflow-hidden bg-black/40 aspect-video relative">
            <video ref=${videoRef} class="w-full h-full object-contain" controls autoplay muted loop playsinline>
              <source src=${mediaUrl} type="video/mp4" />
            </video>
          </div>
        </div>`
    }

    function PlatformCheckboxes({ group, selectedPlatforms, onToggle, accounts }) {
      return html`
        <div class="px-5 pb-3">
          <div class="text-xs font-semibold text-gray-400 mb-2">Select platforms to publish:</div>
          <div class="flex flex-wrap gap-2">
            ${group.items.map(item => {
              const platform = normalizePlatform(item.metadata.platform)
              const cfg = PLATFORMS[platform] || { icon: '‚ùì', color: '#888', name: platform }
              const isSelected = selectedPlatforms.includes(item.id)
              const connAcct = accounts[platform]
              const hasAccount = !!connAcct
              
              return html`
                <label 
                  class="flex items-center gap-2 px-3 py-2 rounded-lg border cursor-pointer transition-all ${
                    isSelected 
                      ? 'bg-white/10 border-white/20' 
                      : 'bg-white/5 border-white/10 hover:bg-white/8'
                  }"
                  style=${isSelected ? `border-color: ${cfg.color}40` : ''}
                >
                  <input 
                    type="checkbox"
                    class="platform-checkbox"
                    checked=${isSelected}
                    onChange=${() => onToggle(item.id)}
                    disabled=${!hasAccount}
                  />
                  <span class="text-lg">${cfg.icon}</span>
                  <span class="text-sm font-medium" style="color: ${cfg.color}">${cfg.name}</span>
                  ${!hasAccount && html`
                    <span class="text-xs px-1.5 py-0.5 rounded bg-red-500/20 text-red-400 border border-red-500/30">‚ö†</span>
                  `}
                </label>
              `
            })}
          </div>
          <div class="mt-2 text-xs text-gray-500">
            ${selectedPlatforms.length} of ${group.items.length} selected
          </div>
        </div>`
    }

    function PostContentPreview({ group }) {
      const firstItem = group.items[0]
      const content = firstItem.postContent || ''
      return html`
        <div class="px-5 pb-3">
          <div class="text-xs font-semibold text-gray-400 mb-1">Post preview:</div>
          <div class="text-sm leading-relaxed text-gray-200 whitespace-pre-wrap break-words max-h-32 overflow-y-auto">
            ${truncate(content, 300)}
          </div>
        </div>`
    }

    function MetaRow({ group }) {
      const sourceVideo = group.sourceVideo || 'Unknown'
      return html`
        <div class="px-5 pb-4 text-xs text-gray-500">
          <span title="Source video">üìπ ${truncate(sourceVideo, 60)}</span>
        </div>`
    }

    function ActionButtons({ onReject, onSkip, onApprove, selectedCount }) {
      const approveDisabled = selectedCount === 0
      return html`
        <div class="px-5 py-4 flex items-center justify-center gap-3">
          <button 
            onClick=${onReject} 
            class="action-btn flex items-center gap-2 px-5 py-2.5 bg-red-500/10 hover:bg-red-500/20 text-red-400 rounded-xl text-sm font-medium border border-red-500/20" 
            title="Reject all (‚Üê)"
          >
            <span>‚ùå</span> Reject All
          </button>
          <button 
            onClick=${onSkip} 
            class="action-btn flex items-center gap-2 px-5 py-2.5 bg-white/5 hover:bg-white/10 text-gray-400 rounded-xl text-sm font-medium border border-white/10" 
            title="Skip (Space)"
          >
            <span>‚è≠Ô∏è</span> Skip
          </button>
          <button 
            onClick=${onApprove} 
            class="action-btn flex items-center gap-2 px-5 py-2.5 rounded-xl text-sm font-medium border ${
              approveDisabled 
                ? 'bg-gray-500/10 text-gray-500 border-gray-500/20 cursor-not-allowed opacity-50' 
                : 'bg-green-500/10 hover:bg-green-500/20 text-green-400 border-green-500/20'
            }" 
            title="Approve selected (‚Üí)"
            disabled=${approveDisabled}
          >
            <span>‚úÖ</span> Approve ${selectedCount > 0 ? `(${selectedCount})` : ''}
          </button>
        </div>`
    }

    function GroupedPostCard({ group, accounts, selectedPlatforms, onTogglePlatform, animClass, onReject, onSkip, onApprove }) {
      const selectedCount = selectedPlatforms.length
      return html`
        <div class="w-full max-w-2xl" style="max-height: calc(100vh - 160px); display: flex; flex-direction: column;">
          <div class="bg-card rounded-2xl shadow-2xl border border-white/5 overflow-hidden flex flex-col ${animClass}" style="max-height: 100%;" key=${group.groupKey}>
            <!-- Fixed top: clip type badge -->
            <div class="flex-shrink-0 flex items-center justify-between px-5 pt-4 pb-2">
              <div class="flex items-center gap-2">
                <${ClipTypeBadge} clipType=${group.clipType} />
              </div>
            </div>
            <!-- Scrollable middle: video + checkboxes + preview -->
            <div class="flex-1 overflow-y-auto min-h-0">
              <${VideoPlayer} group=${group} />
              <${PlatformCheckboxes} 
                group=${group} 
                selectedPlatforms=${selectedPlatforms} 
                onToggle=${onTogglePlatform}
                accounts=${accounts}
              />
              <${PostContentPreview} group=${group} />
              <${MetaRow} group=${group} />
            </div>
            <!-- Fixed bottom: action buttons -->
            <div class="flex-shrink-0 border-t border-white/5">
              <${ActionButtons} 
                onReject=${onReject} 
                onSkip=${onSkip} 
                onApprove=${onApprove}
                selectedCount=${selectedCount}
              />
            </div>
          </div>
        </div>`
    }

    function Footer({ groups, index, stats, allDone }) {
      const total = groups.length
      const current = Math.min(index + 1, total)
      const progressText = allDone ? 'Review complete' : (total > 0 ? `Group ${current} of ${total}` : '')
      return html`
        <footer class="flex-shrink-0 border-t border-white/5 bg-surface/50">
          <div class="max-w-4xl mx-auto px-4 py-2.5 flex items-center justify-between text-xs text-gray-500">
            <span>${progressText}</span>
            <div class="flex items-center gap-3">
              ${stats.approved > 0 && html`<span class="text-green-400/70">‚úÖ ${stats.approved}</span>`}
              ${stats.rejected > 0 && html`<span class="text-red-400/70">‚ùå ${stats.rejected}</span>`}
              ${stats.skipped > 0 && html`<span class="text-gray-500">‚è≠Ô∏è ${stats.skipped}</span>`}
            </div>
          </div>
        </footer>`
    }

    // ‚îÄ‚îÄ App ‚îÄ‚îÄ
    function App() {
      const [allGroups, setAllGroups] = useState(null) // null = loading
      const [accounts, setAccounts] = useState({})
      const [profileName, setProfileName] = useState(null)
      const [index, setIndex] = useState(0)
      const [selectedPlatforms, setSelectedPlatforms] = useState([])
      const [busy, setBusy] = useState(false)
      const [busyText, setBusyText] = useState('Processing‚Ä¶')
      const [stats, setStats] = useState({ approved: 0, rejected: 0, skipped: 0 })
      const [animClass, setAnimClass] = useState('card-enter')

      // Parallel data loading via combined init endpoint
      useEffect(() => {
        const fetchAll = async () => {
          try {
            const res = await fetch('/api/init')
            if (!res.ok) throw new Error(`HTTP ${res.status}`)
            const data = await res.json()

            setAllGroups(data.groups || [])

            const acctMap = {}
            for (const acct of (data.accounts || [])) {
              if (acct.platform) acctMap[acct.platform] = acct
            }
            setAccounts(acctMap)

            if (data.profile && data.profile.name) setProfileName(data.profile.name)
          } catch (err) {
            showToast(`Failed to load: ${err.message}`, 'error')
            setAllGroups([])
          }
        }
        fetchAll()
      }, [])

      const currentGroup = allGroups && allGroups[index] || null
      const isLoading = allGroups === null
      const isEmpty = allGroups !== null && allGroups.length === 0
      const allDone = !isEmpty && !isLoading && index >= allGroups.length

      // Auto-select all platforms with connected accounts when group changes
      useEffect(() => {
        if (currentGroup) {
          const availableIds = currentGroup.items
            .filter(item => {
              const platform = normalizePlatform(item.metadata.platform)
              return !!accounts[platform]
            })
            .map(item => item.id)
          setSelectedPlatforms(availableIds)
        }
      }, [currentGroup, accounts])

      const togglePlatform = useCallback((itemId) => {
        setSelectedPlatforms(prev => 
          prev.includes(itemId) 
            ? prev.filter(id => id !== itemId)
            : [...prev, itemId]
        )
      }, [])

      const animateOut = useCallback((cb) => {
        setAnimClass('card-exit')
        setTimeout(() => {
          cb()
          setAnimClass('card-enter')
        }, 250)
      }, [])

      const approveGroup = useCallback(async () => {
        if (busy || !currentGroup || selectedPlatforms.length === 0) return
        
        setBusy(true)
        setBusyText(`Scheduling ${selectedPlatforms.length} post(s)‚Ä¶`)
        
        try {
          const res = await fetch('/api/posts/bulk-approve', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ itemIds: selectedPlatforms }),
          })
          
          const data = await res.json()
          if (!res.ok) throw new Error(data.error || `HTTP ${res.status}`)
          
          setStats(s => ({ ...s, approved: s.approved + selectedPlatforms.length }))
          showToast(`Approved ${selectedPlatforms.length} post(s)!`, 'success')
          
          animateOut(() => {
            setAllGroups(prev => prev.filter(g => g.groupKey !== currentGroup.groupKey))
            setSelectedPlatforms([])
          })
        } catch (err) {
          showToast(`Approve failed: ${err.message}`, 'error')
        } finally {
          setBusy(false)
        }
      }, [busy, currentGroup, selectedPlatforms, animateOut])

      const rejectGroup = useCallback(async () => {
        if (busy || !currentGroup) return
        
        const allIds = currentGroup.items.map(i => i.id)
        setBusy(true)
        setBusyText('Rejecting‚Ä¶')
        
        try {
          const res = await fetch('/api/posts/bulk-reject', {
            method: 'POST',
            headers: { 'Content-Type': 'application/json' },
            body: JSON.stringify({ itemIds: allIds }),
          })
          
          const data = await res.json()
          if (!res.ok) throw new Error(data.error || `HTTP ${res.status}`)
          
          setStats(s => ({ ...s, rejected: s.rejected + allIds.length }))
          showToast('Group rejected', 'info')
          
          animateOut(() => {
            setAllGroups(prev => prev.filter(g => g.groupKey !== currentGroup.groupKey))
            setSelectedPlatforms([])
          })
        } catch (err) {
          showToast(`Reject failed: ${err.message}`, 'error')
        } finally {
          setBusy(false)
        }
      }, [busy, currentGroup, animateOut])

      const skipGroup = useCallback(() => {
        if (busy) return
        const itemCount = currentGroup ? currentGroup.items.length : 0
        setStats(s => ({ ...s, skipped: s.skipped + itemCount }))
        setIndex(i => i + 1)
        setSelectedPlatforms([])
      }, [busy, currentGroup])

      // Keyboard shortcuts
      useEffect(() => {
        const handler = (e) => {
          if (busy) return
          switch (e.key) {
            case 'ArrowLeft':  e.preventDefault(); rejectGroup(); break
            case 'ArrowRight': e.preventDefault(); approveGroup(); break
            case ' ':          e.preventDefault(); skipGroup(); break
          }
        }
        document.addEventListener('keydown', handler)
        return () => document.removeEventListener('keydown', handler)
      }, [busy, rejectGroup, approveGroup, skipGroup])

      // Main content
      let mainContent
      if (isLoading) {
        mainContent = html`<${SkeletonCard} />`
      } else if (isEmpty) {
        mainContent = html`<${EmptyState} />`
      } else if (allDone) {
        mainContent = html`<${SummaryState} stats=${stats} />`
      } else if (currentGroup) {
        mainContent = html`
          <${GroupedPostCard}
            group=${currentGroup}
            accounts=${accounts}
            selectedPlatforms=${selectedPlatforms}
            onTogglePlatform=${togglePlatform}
            animClass=${animClass}
            onReject=${rejectGroup}
            onSkip=${skipGroup}
            onApprove=${approveGroup}
          />`
      }

      return html`
        <div class="h-full flex flex-col">
          <${LoadingOverlay} busy=${busy} text=${busyText} />
          <${Header} profileName=${profileName} />
          <main class="flex-1 overflow-y-auto flex items-start justify-center pt-6 pb-4 px-4">
            ${mainContent}
          </main>
          <${Footer} groups=${allGroups || []} index=${index} stats=${stats} allDone=${allDone || isEmpty} />
        </div>`
    }

    render(html`<${App} />`, document.getElementById('app'))
  </script>
</body>
</html>
